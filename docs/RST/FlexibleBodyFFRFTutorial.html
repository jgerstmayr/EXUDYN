

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flexible body – FFRF tutorial &mdash; Exudyn1.9.0 1.9.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=82a976d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/rtd_sphinx_search.min.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=e11081fd" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=c4cb232b"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/js/rtd_search_config.js"></script>
      <script src="../../_static/js/rtd_sphinx_search.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Graphics and visualization" href="GraphicsAndVisualizationIndex.html" />
    <link rel="prev" title="Symbolic user function tutorial" href="SymbolicUserFunctionTutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Exudyn1.9.0
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Exudyn User Manual</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Exudyn.html">Exudyn</a></li>
<li class="toctree-l1"><a class="reference internal" href="InstallationAndGettingStartedIndex.html">Installation and Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="OverviewOnExudynIndex.html">Overview on Exudyn</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="TutorialIndex.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Tutorial.html">Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="MassSpringDamperTutorial.html">Mass-Spring-Damper tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="RigidBodyAndJointsTutorial.html">Rigid body and joints tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="FlexibleBeamsTutorial.html">Flexible beams tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="SymbolicUserFunctionTutorial.html">Symbolic user function tutorial</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Flexible body – FFRF tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="GraphicsAndVisualizationIndex.html">Graphics and visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="NotationIndex.html">Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="TheoryAndFormulationsIndex.html">Theory and formulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="SolversIndex.html">Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="cInterface/CInterfaceIndex.html">Python-C++ command interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pythonUtilities/index.html">Python Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="items/itemsIndex.html">Items reference manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="structures/StructuresAndSettingsIndex.html">Structures and Settings</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Abbreviations.html">List of Abbreviations</a></li>
<li class="toctree-l1"><a class="reference internal" href="ExamplesIndex.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="TestModelsIndex.html">TestModels</a></li>
<li class="toctree-l1"><a class="reference internal" href="trackerlog.html">Issue tracker</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Exudyn1.9.0</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="TutorialIndex.html">Tutorial</a></li>
      <li class="breadcrumb-item active">Flexible body – FFRF tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/RST/FlexibleBodyFFRFTutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="flexible-body-ffrf-tutorial">
<h1>Flexible body – FFRF tutorial<a class="headerlink" href="#flexible-body-ffrf-tutorial" title="Link to this heading"></a></h1>
<p>The following tutorial includes flexible bodies, using the floating frame of reference formulation (FFRF),
including Netgen and NGsolve for mesh and finite element data generation and uses modal reduction for simulation.
The tutorial will set up a body with Hurty-Craig-Bampton modes, giving a simple flexible pendulum meshed hinged with a revolute joint.</p>
<figure class="align-default" id="id1">
<span id="fig-tutorial-ffrfpendulum"></span><a class="reference internal image-reference" href="../../_images/TutorialFFRFpendulum.png"><img alt="../../_images/TutorialFFRFpendulum.png" src="../../_images/TutorialFFRFpendulum.png" style="width: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 12 </span><span class="caption-text">Screen shot of pendulum modeled with floating frame of reference formulation, using HCB modes, and meshed with Netgen.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>We import the exudyn library, utilities, and other necessary modules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">exudyn</span> <span class="k">as</span> <span class="nn">exu</span>
<span class="kn">from</span> <span class="nn">exudyn.utilities</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c1"># includes itemInterface and rigidBodyUtilities</span>
<span class="kn">import</span> <span class="nn">exudyn.graphics</span> <span class="k">as</span> <span class="nn">graphics</span>  <span class="c1"># only import if it does not conflict</span>
<span class="kn">from</span> <span class="nn">exudyn.FEM</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">ngsolve</span> <span class="k">as</span> <span class="nn">ngs</span>
<span class="kn">from</span> <span class="nn">netgen.meshing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">netgen.csg</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>Next, we need a <code class="docutils literal notranslate"><span class="pre">SystemContainer</span></code>, which contains all computable systems and adds a new MainSystem <code class="docutils literal notranslate"><span class="pre">mbs</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SC</span> <span class="o">=</span> <span class="n">exu</span><span class="o">.</span><span class="nc">SystemContainer</span><span class="p">()</span>
<span class="n">mbs</span> <span class="o">=</span> <span class="n">SC</span><span class="o">.</span><span class="nf">AddSystem</span><span class="p">()</span>
</pre></div>
</div>
<p>Define the parameters and setup the Netgen mesh, using Netgen’s CSG geometry. We create a simple brick in order to simplify the application of boundary interfaces and joints:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">useGraphics</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">fileName</span> <span class="o">=</span> <span class="s1">&#39;testData/netgenBrick&#39;</span>  <span class="c1"># for load/save of FEM data</span>

<span class="n">a</span> <span class="o">=</span> <span class="mf">0.025</span>  <span class="c1"># height/width of beam</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">a</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>     <span class="c1"># Length of beam</span>
<span class="n">nModes</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">rho</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">Emodulus</span> <span class="o">=</span> <span class="mf">1e7</span> <span class="o">*</span> <span class="mi">10</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">meshCreated</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">meshOrder</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># use order 2 for higher accuracy, but more unknowns</span>

<span class="n">geo</span> <span class="o">=</span> <span class="n">CSGeometry</span><span class="p">()</span>
<span class="n">block</span> <span class="o">=</span> <span class="n">OrthoBrick</span><span class="p">(</span><span class="n">Pnt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">),</span> <span class="n">Pnt</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="n">geo</span><span class="o">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">ngs</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">GenerateMesh</span><span class="p">(</span><span class="n">maxh</span><span class="o">=</span><span class="n">h</span><span class="p">))</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>When creating the geometry and mesh, we sometimes would like to verify that with Netgen’s GUI.
In Jupyter, this works smoother with <code class="docutils literal notranslate"><span class="pre">webgui_jupyter_widgets</span></code> – see the Netgen documention. Here we use a simple loop, which has to set <code class="docutils literal notranslate"><span class="pre">True</span></code> if visualization shall run:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="kc">False</span><span class="p">:</span>  <span class="c1"># set this to true, if you want to visualize the mesh inside netgen/ngsolve</span>
    <span class="kn">import</span> <span class="nn">netgen.gui</span>
    <span class="n">ngs</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000000</span><span class="p">):</span>
        <span class="n">netgen</span><span class="o">.</span><span class="n">Redraw</span><span class="p">()</span>  <span class="c1"># this makes the window interactive</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
<p>Use the FEM interface to import the FEM model and create the FFRF reduced-order data stored in fem.
Note that on importing the FEM structure from NGsolve (the FEM-module and solver of Netgen), we
have to specify the mechanical properties related to the mesh:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fem</span> <span class="o">=</span> <span class="nc">FEMinterface</span><span class="p">()</span>
<span class="p">[</span><span class="n">bfM</span><span class="p">,</span> <span class="n">bfK</span><span class="p">,</span> <span class="n">fes</span><span class="p">]</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="nf">ImportMeshFromNGsolve</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span>
                                            <span class="n">youngsModulus</span><span class="o">=</span><span class="n">Emodulus</span><span class="p">,</span>
                                            <span class="n">poissonsRatio</span><span class="o">=</span><span class="n">nu</span><span class="p">,</span>
                                            <span class="n">meshOrder</span><span class="o">=</span><span class="n">meshOrder</span><span class="p">)</span>
</pre></div>
</div>
<p>We could now just compute eigenmodes of the free bodies. However, as mentioned in the theory part, they do not respect boundary conditions and lead to low accuracy. Therefore, we use Hurty-Craig-Bampton modes.
For them, we have to define boundary interfaces given as lists of node numbers as well as weights.
We can use convenient functions from the <code class="docutils literal notranslate"><span class="pre">FEMinterface</span></code> class to retrieve nodes from planar or cylindrical surfaces (or we may define them in the finite element model ourselves):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pLeft</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">]</span>
<span class="n">pRight</span> <span class="o">=</span> <span class="p">[</span><span class="n">L</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span><span class="p">]</span>
<span class="n">nTip</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="nf">GetNodeAtPoint</span><span class="p">(</span><span class="n">pRight</span><span class="p">)</span> <span class="c1">#for sensor</span>
<span class="n">nodesLeftPlane</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="nf">GetNodesInPlane</span><span class="p">(</span><span class="n">pLeft</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">weightsLeftPlane</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="nf">GetNodeWeightsFromSurfaceAreas</span><span class="p">(</span><span class="n">nodesLeftPlane</span><span class="p">)</span>
<span class="n">nodesRightPlane</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="nf">GetNodesInPlane</span><span class="p">(</span><span class="n">pRight</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">weightsRightPlane</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="nf">GetNodeWeightsFromSurfaceAreas</span><span class="p">(</span><span class="n">nodesRightPlane</span><span class="p">)</span>
</pre></div>
</div>
<p>We define a list of boundaries, which are then passed to the function which computes modes.
Note that by default the first boundary modes are eliminated as they are fixed to the reference frame
of the FFRF object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">boundaryList</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodesLeftPlane</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nNodes=&quot;</span><span class="p">,</span> <span class="n">fem</span><span class="o">.</span><span class="nf">NumberOfNodes</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;compute HCB modes... &quot;</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">fem</span><span class="o">.</span><span class="nf">ComputeHurtyCraigBamptonModes</span><span class="p">(</span><span class="n">boundaryNodesList</span><span class="o">=</span><span class="n">boundaryList</span><span class="p">,</span>
                                  <span class="n">nEigenModes</span><span class="o">=</span><span class="n">nModes</span><span class="p">,</span>
                                  <span class="n">useSparseSolver</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">computationMode</span><span class="o">=</span><span class="nc">HCBstaticModeSelection</span><span class="o">.</span><span class="n">RBE2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HCB modes needed</span>
</pre></div>
</div>
<p>Compute stress modes for postprocessing, which is not needed for simulation, but useful for postprocessing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="nc">KirchhoffMaterial</span><span class="p">(</span><span class="n">Emodulus</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
    <span class="n">varType</span> <span class="o">=</span> <span class="n">exu</span><span class="o">.</span><span class="nc">OutputVariableType</span><span class="o">.</span><span class="n">StressLocal</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ComputePostProcessingModes ... (may take a while)&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">fem</span><span class="o">.</span><span class="nf">ComputePostProcessingModesNGsolve</span><span class="p">(</span><span class="n">fes</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span>
                                          <span class="n">outputVariableType</span><span class="o">=</span><span class="n">varType</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ... needed</span>
    <span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">contour</span><span class="o">.</span><span class="n">reduceRange</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">contour</span><span class="o">.</span><span class="n">outputVariable</span> <span class="o">=</span> <span class="n">varType</span>
    <span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">contour</span><span class="o">.</span><span class="n">outputVariableComponent</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># x-component</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">contour</span><span class="o">.</span><span class="n">outputVariable</span> <span class="o">=</span> <span class="n">exu</span><span class="o">.</span><span class="nc">OutputVariableType</span><span class="o">.</span><span class="n">DisplacementLocal</span>
    <span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">contour</span><span class="o">.</span><span class="n">outputVariableComponent</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Having all data prepared now, we create the CMS element which is an object added then to <code class="docutils literal notranslate"><span class="pre">mbs</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;create CMS element ...&quot;</span><span class="p">)</span>
<span class="n">cms</span> <span class="o">=</span> <span class="nc">ObjectFFRFreducedOrderInterface</span><span class="p">(</span><span class="n">fem</span><span class="p">)</span>
<span class="n">objFFRF</span> <span class="o">=</span> <span class="n">cms</span><span class="o">.</span><span class="nf">AddObjectFFRFreducedOrder</span><span class="p">(</span><span class="n">mbs</span><span class="p">,</span> <span class="n">positionRef</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="n">initialVelocity</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="n">initialAngularVelocity</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="n">gravity</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
</pre></div>
</div>
<p>Add markers and revolute joint, using a superelement marker:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nodeDrawSize</span> <span class="o">=</span> <span class="mf">0.0025</span>  <span class="c1"># for joint drawing</span>

<span class="n">mRB</span> <span class="o">=</span> <span class="n">mbs</span><span class="o">.</span><span class="nf">AddMarker</span><span class="p">(</span><span class="nc">MarkerNodeRigid</span><span class="p">(</span><span class="n">nodeNumber</span><span class="o">=</span><span class="n">objFFRF</span><span class="p">[</span><span class="s1">&#39;nRigidBody&#39;</span><span class="p">]))</span>
<span class="n">oGround</span> <span class="o">=</span> <span class="n">mbs</span><span class="o">.</span><span class="nf">AddObject</span><span class="p">(</span><span class="nc">ObjectGround</span><span class="p">(</span><span class="n">referencePosition</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
<span class="n">leftMidPoint</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">mGround</span> <span class="o">=</span> <span class="n">mbs</span><span class="o">.</span><span class="nf">AddMarker</span><span class="p">(</span><span class="nc">MarkerBodyRigid</span><span class="p">(</span><span class="n">bodyNumber</span><span class="o">=</span><span class="n">oGround</span><span class="p">,</span> <span class="n">localPosition</span><span class="o">=</span><span class="n">leftMidPoint</span><span class="p">))</span>
<span class="n">mLeft</span> <span class="o">=</span> <span class="n">mbs</span><span class="o">.</span><span class="nf">AddMarker</span><span class="p">(</span><span class="nc">MarkerSuperElementRigid</span><span class="p">(</span><span class="n">bodyNumber</span><span class="o">=</span><span class="n">objFFRF</span><span class="p">[</span><span class="s1">&#39;oFFRFreducedOrder&#39;</span><span class="p">],</span>
                                              <span class="n">meshNodeNumbers</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nodesLeftPlane</span><span class="p">),</span>
                                              <span class="n">weightingFactors</span><span class="o">=</span><span class="n">weightsLeftPlane</span><span class="p">))</span>
<span class="n">mbs</span><span class="o">.</span><span class="nf">AddObject</span><span class="p">(</span><span class="nc">GenericJoint</span><span class="p">(</span><span class="n">markerNumbers</span><span class="o">=</span><span class="p">[</span><span class="n">mGround</span><span class="p">,</span> <span class="n">mLeft</span><span class="p">],</span>
                           <span class="n">constrainedAxes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">0</span><span class="p">],</span>
                           <span class="n">visualization</span><span class="o">=</span><span class="nc">VGenericJoint</span><span class="p">(</span><span class="n">axesRadius</span><span class="o">=</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">axesLength</span><span class="o">=</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">a</span><span class="p">)))</span>
</pre></div>
</div>
<p>Note that the marker is using weights, which are needed to compute accurate average (midpoint) positions from the non-uniform triangular surface mesh.</p>
<p>Now we finally add a sensor and assemble the system:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fileDir</span> <span class="o">=</span> <span class="s1">&#39;solution/&#39;</span>
<span class="n">sensTipDispl</span> <span class="o">=</span> <span class="n">mbs</span><span class="o">.</span><span class="nf">AddSensor</span><span class="p">(</span><span class="nc">SensorSuperElement</span><span class="p">(</span><span class="n">bodyNumber</span><span class="o">=</span><span class="n">objFFRF</span><span class="p">[</span><span class="s1">&#39;oFFRFreducedOrder&#39;</span><span class="p">],</span>
                                                <span class="n">meshNodeNumber</span><span class="o">=</span><span class="n">nTip</span><span class="p">,</span>
                                                <span class="n">fileName</span><span class="o">=</span><span class="n">fileDir</span> <span class="o">+</span> <span class="s1">&#39;nMidDisplacementCMS&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nModes</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;Test.txt&#39;</span><span class="p">,</span>
                                                <span class="n">outputVariableType</span><span class="o">=</span><span class="n">exu</span><span class="o">.</span><span class="nc">OutputVariableType</span><span class="o">.</span><span class="n">Displacement</span><span class="p">))</span>

<span class="n">mbs</span><span class="o">.</span><span class="nf">Assemble</span><span class="p">()</span>
</pre></div>
</div>
<p>Set simulation settings and run the simulation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">simulationSettings</span> <span class="o">=</span> <span class="n">exu</span><span class="o">.</span><span class="nc">SimulationSettings</span><span class="p">()</span>

<span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">defaultSize</span> <span class="o">=</span> <span class="n">nodeDrawSize</span>
<span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">drawNodesAsPoint</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">connectors</span><span class="o">.</span><span class="n">defaultSize</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nodeDrawSize</span>
<span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">sensors</span><span class="o">.</span><span class="n">defaultSize</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">markers</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">SC</span><span class="o">.</span><span class="nf">visualizationSettings</span><span class="o">.</span><span class="n">loads</span><span class="o">.</span><span class="n">drawSimplified</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">h</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="n">tEnd</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">simulationSettings</span><span class="o">.</span><span class="n">timeIntegration</span><span class="o">.</span><span class="n">numberOfSteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tEnd</span> <span class="o">/</span> <span class="n">h</span><span class="p">)</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">timeIntegration</span><span class="o">.</span><span class="n">endTime</span> <span class="o">=</span> <span class="n">tEnd</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">timeIntegration</span><span class="o">.</span><span class="n">verboseMode</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">timeIntegration</span><span class="o">.</span><span class="n">newton</span><span class="o">.</span><span class="n">useModifiedNewton</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">solutionSettings</span><span class="o">.</span><span class="n">sensorsWritePeriod</span> <span class="o">=</span> <span class="n">h</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">timeIntegration</span><span class="o">.</span><span class="n">generalizedAlpha</span><span class="o">.</span><span class="n">spectralRadius</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">displayComputationTime</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">mbs</span><span class="o">.</span><span class="nf">SolveDynamic</span><span class="p">(</span><span class="n">simulationSettings</span><span class="o">=</span><span class="n">simulationSettings</span><span class="p">)</span>

<span class="n">uTip</span> <span class="o">=</span> <span class="n">mbs</span><span class="o">.</span><span class="nf">GetSensorValues</span><span class="p">(</span><span class="n">sensTipDispl</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nModes=&quot;</span><span class="p">,</span> <span class="n">nModes</span><span class="p">,</span> <span class="s2">&quot;, tip displacement=&quot;</span><span class="p">,</span> <span class="n">uTip</span><span class="p">)</span>

<span class="n">mbs</span><span class="o">.</span><span class="nf">SolutionViewer</span><span class="p">()</span>
</pre></div>
</div>
<p>When the solution viewer starts, it should show the stresses in a flexible swinging pendulum, see <a class="reference internal" href="#fig-tutorial-ffrfpendulum"><span class="std std-numref">Fig. 12</span></a>.</p>
<p>NOTE: this tutorial has been mostly created with ChatGPT-4, and curated hereafter!</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="SymbolicUserFunctionTutorial.html" class="btn btn-neutral float-left" title="Symbolic user function tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="GraphicsAndVisualizationIndex.html" class="btn btn-neutral float-right" title="Graphics and visualization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>