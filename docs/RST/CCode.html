<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>C++ Code &mdash; Exudyn1.7.0 1.7.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/rtd_sphinx_search.min.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/js/rtd_search_config.js"></script>
        <script src="../../_static/js/rtd_sphinx_search.min.js"></script>
        <script>window.MathJax = {"loader": {"load": ["[tex]/mathtools"]}, "tex": {"packages": {"[+]": ["mathtools"]}, "macros": {"vspace": ["{}", 1], "ra": "{\\rightarrow}", "Rcal": "{\\mathbb{R}}", "Ccal": "{\\mathbb{C}}", "Ncal": "{\\mathbb{N}}", "Rot": "{\\mathbf{A}}", "dd": "{\\mathrm{d}}", "co": "{\\mathrm{c}}", "si": "{\\mathrm{s}}", "tp": "{^\\mathrm{T}}", "diag": "{\\mathrm{diag}}", "vec": "{\\mathrm{vec}}", "Null": "{\\mathbf{0}}", "varepsilonDot": "{\\boldsymbol{\\varepsilon}}", "talpha": "{\\boldsymbol{\\alpha}}", "tbeta": "{\\boldsymbol{\\beta}}", "tgamma": "{\\boldsymbol{\\gamma}}", "tchi": "{\\boldsymbol{\\chi}}", "tdelta": "{\\boldsymbol{\\delta}}", "teps": "{\\boldsymbol{\\varepsilon}}", "tepsDot": "{\\boldsymbol{\\dot \\varepsilon}}", "teta": "{\\boldsymbol{\\eta}}", "tkappa": "{\\boldsymbol{\\kappa}}", "tkappaDot": "{\\boldsymbol{\\dot \\kappa}}", "tphi": "{\\boldsymbol{\\phi}}", "tPhi": "{\\boldsymbol{\\Phi}}", "ttheta": "{\\boldsymbol{\\theta}}", "tTheta": "{\\boldsymbol{\\Theta}}", "tlambda": "{\\boldsymbol{\\lambda}}", "tnu": "{\\boldsymbol{\\nu}}", "tmu": "{\\boldsymbol{\\mu}}", "tpsi": "{\\boldsymbol{\\psi}}", "tPsi": "{\\boldsymbol{\\Psi}}", "ttau": "{\\boldsymbol{\\tau}}", "tsigma": "{\\boldsymbol{\\sigma}}", "txi": "{\\boldsymbol{\\xi}}", "tzeta": "{\\boldsymbol{\\zeta}}", "tomega": "{\\boldsymbol{\\omega}}", "tOmega": "{\\boldsymbol{\\Omega}}", "vareps": "{\\varepsilon}", "pluseq": "\\mathrel{+}=", "LU": ["{\\prescript{#1}{}{#2}\\,}", 2], "LUX": ["{\\prescript{#1}{}{#2}#3\\,}", 3], "LUR": ["{\\prescript{#1}{}{#2}_{#3}\\,}", 3], "LURU": ["{\\prescript{#1}{}{#2}_{#3}^{#4}\\,}", 4], "LLdot": ["{\\prescript{}{#1}{\\dot{#2}}_{#3}\\,}", 3], "vr": ["{\\left[ \\begin{array}{c} { #1}\\vspace{0.04cm} \\\\ { #2}\\vspace{0.04cm} \\\\ { #3} \\end{array} \\right]}", 3], "mr": ["{\\left[ \\begin{array}{ccc} #1 & #2 & #3 \\vspace{0.04cm}\\\\ #4 & #5 & #6 \\vspace{0.04cm}\\\\ #7 & #8 & #9  \\end{array} \\right]}", 9], "vp": ["{\\left[ \\begin{array}{c} { #1} \\vspace{0.04cm}\\\\ { #2} \\end{array} \\right]}", 2], "mp": ["{\\left[ \\begin{array}{cc} #1 & #2 \\vspace{0.04cm}\\\\ #3 & #4 \\end{array} \\right]}", 4], "vrRow": ["{[#1,\\, #2,\\, #3]}", 3], "vsix": ["{\\left[\\!\\! \\begin{array}{c} { #1} \\\\ { #2} \\\\ { #3} \\\\ { #4} \\\\ { #5} \\\\ { #6} \\end{array} \\!\\!\\right]}", 6], "vsixb": ["{\\begin{array}{c} { #1} \\\\ { #2} \\\\ { #3} \\\\ { #4} \\\\ { #5} \\\\ { #6} \\end{array} }", 6], "vsixs": ["{ \\begin{array}{c} { #1} \\\\ { #2} \\\\ { #3} \\\\ { #4} \\\\ { #5} \\\\ { #6} \\end{array} }", 6], "SO": "{q}", "FO": "{y}", "AE": "{\\lambda}", "SYS": "{s}", "SON": "{$2^\\mathrm{nd}$ order differential equations}", "FON": "{$1^\\mathrm{st}$ order differential equations}", "AEN": "{algebraic equations}", "SYSN": "{system equations}", "cIni": "{_\\mathrm{ini}}", "cRef": "{_\\mathrm{ref}}", "cCur": "{_\\mathrm{cur}}", "cVis": "{_\\mathrm{vis}}", "cSOS": "{_\\mathrm{start\\;of\\;step}}", "cConfig": "{_\\mathrm{config}}", "pLoc": "{\\mathbf{b}}", "pLocB": "{\\,^{b}{\\mathbf{v}}}", "pRef": "{\\mathbf{r}}", "pRefG": "{\\,^{0}{\\mathbf{r}}}", "indf": "{_\\mathrm{f}}", "indt": "{_\\mathrm{t}}", "indr": "{_\\mathrm{r}}", "indtt": "{_\\mathrm{tt}}", "indrr": "{_\\mathrm{rr}}", "indff": "{_\\mathrm{ff}}", "indtf": "{_\\mathrm{tf}}", "indrf": "{_\\mathrm{rf}}", "indtr": "{_\\mathrm{tr}}", "omegaBDtilde": "{\\LU{b}{\\tilde \\tomega_\\mathrm{bd}}}", "indrigid": "{_\\mathrm{rigid}}", "indred": "{_\\mathrm{red}}", "induser": "{_\\mathrm{user}}", "indu": "{_\\mathrm{u}}", "termA": ["{\\color{blue}{#1}}", 1], "termB": ["{\\color{red}{#1}}", 1], "termC": ["{\\color{green}{#1}}", 1], "avu": "{\\ddot \\mathbf{q}}", "GA": "{G\\alpha}", "aalg": "{\\mathbf{a}}", "vel": "{\\mathbf{v}}"}}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Tutorial" href="TutorialIndex.html" />
    <link rel="prev" title="Advanced topics" href="AdvancedTopics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Exudyn1.7.0
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Exudyn User Manual</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Exudyn.html">Exudyn</a></li>
<li class="toctree-l1"><a class="reference internal" href="InstallationAndGettingStartedIndex.html">Installation and Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="OverviewOnExudynIndex.html">Overview on Exudyn</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="OverviewOnExudyn.html">Overview on Exudyn</a></li>
<li class="toctree-l2"><a class="reference internal" href="ModuleStructure.html">Module structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="ItemsNodesObjectsLoadsMarkersSensors.html">Items: Nodes, Objects, Loads, Markers, Sensors, …</a></li>
<li class="toctree-l2"><a class="reference internal" href="MappingBetweenLocalAndGlobalCoordinateIndices.html">Mapping between local and global coordinate indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="ExudynBasics.html">Exudyn Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="AdvancedTopics.html">Advanced topics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">C++ Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#focus-of-the-c-code">Focus of the C++ code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-code-structure">C++ Code structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-code-modules">C++ Code: Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-style-and-conventions">Code style and conventions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notation-conventions">Notation conventions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#no-abbreviations-rule">No-abbreviations-rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementation-of-new-computational-items-in-c">Implementation of new computational items in C++</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="TutorialIndex.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="GraphicsAndVisualizationIndex.html">Graphics and visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="NotationIndex.html">Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="TheoryAndFormulationsIndex.html">Theory and formulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="SolversIndex.html">Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="cInterface/CInterfaceIndex.html">Python-C++ command interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pythonUtilities/index.html">Python Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="items/itemsIndex.html">Items reference manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="structures/StructuresAndSettingsIndex.html">Structures and Settings</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Abbreviations.html">List of Abbreviations</a></li>
<li class="toctree-l1"><a class="reference internal" href="ExamplesIndex.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="TestModelsIndex.html">TestModels</a></li>
<li class="toctree-l1"><a class="reference internal" href="trackerlog.html">Issue tracker</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Exudyn1.7.0</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="OverviewOnExudynIndex.html">Overview on Exudyn</a></li>
      <li class="breadcrumb-item active">C++ Code</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/RST/CCode.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="c-code">
<span id="sec-overview-cppcode"></span><h1>C++ Code<a class="headerlink" href="#c-code" title="Permalink to this heading"></a></h1>
<p>This section covers some information on the C++ code. For more information see the Open source code and use doxygen.</p>
<p>Exudyn was developed for the efficient simulation of flexible multi-body systems. Exudyn was designed for rapid implementation and testing of new formulations and algorithms in multibody systems, whereby these algorithms can be easily implemented in efficient C++ code. The code is applied to industry-related research projects and applications.</p>
<section id="focus-of-the-c-code">
<h2>Focus of the C++ code<a class="headerlink" href="#focus-of-the-c-code" title="Permalink to this heading"></a></h2>
<p>The code focuses on four principles, starting with highest priority:</p>
<ul class="simple">
<li><p>developer-friendly</p></li>
<li><p>error minimization</p></li>
<li><p>user-friendliness</p></li>
<li><p>efficiency</p></li>
</ul>
<p>The focus is therefore on:</p>
<ul class="simple">
<li><p>A developer-friendly basic structure regarding the C++ class library and the possibility to add new components.</p></li>
<li><p>The basic libraries are slim, but extensively tested; only the necessary components are available</p></li>
<li><p>Complete unit tests are added to new program parts during development; for more complex processes, tests are available in Python</p></li>
<li><p>In order to implement the sometimes difficult formulations and algorithms without errors, error avoidance is always prioritized.</p></li>
<li><p>To generate efficient code, classes for parallelization (vectorization and multithreading) are provided. We live the principle that parallelization takes place on multi-core processors with a central main memory, and thus an increase in efficiency through parallelization is only possible with small systems, as long as the program runs largely in the cache of the processor cores. Vectorization is tailored to SIMD commands as they have Intel processors, but could also be extended to GPGPUs in the future.</p></li>
<li><p>The user interface (Python) provides a nearly 1:1 image of the system and the processes running in it, which can be controlled with the extensive possibilities of Python.</p></li>
</ul>
</section>
<section id="c-code-structure">
<h2>C++ Code structure<a class="headerlink" href="#c-code-structure" title="Permalink to this heading"></a></h2>
<p>The following <strong>entry points</strong> into the C++ code can be found:</p>
<ul class="simple">
<li><p>Python – C++: the creation of the module <code class="docutils literal notranslate"><span class="pre">exudyn</span></code> is found in:</p></li>
</ul>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">main/src/Pymodules/PybindModule.cpp</span></code></p>
<p>it includes large header files, which are automatically created for binding C++ code with Python.</p>
</div></blockquote>
<ul>
<li><p>The object factory for creation of items (calling <code class="docutils literal notranslate"><span class="pre">mbs.AddNode(...)</span></code> and similar):</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">main/src/Main/MainObjectFactory.h</span> <span class="pre">/</span> <span class="pre">.cpp</span></code></p>
</div></blockquote>
</li>
<li><p>Using the VisualStudio <code class="docutils literal notranslate"><span class="pre">.sln</span></code> file and using the Debug mode allows you to smoothly walk from Python to C++ code (though that this takes some time to start up and it does not work always; and it does not work for graphics if it runs in a separate thread).</p></li>
</ul>
<p>The functionality of the code is mainly based on systems (MainSystem and CSystem), items and solvers representing the multibody system or similar physical systems to be simulated. Parts of the core structure of Exudyn are:</p>
<ul class="simple">
<li><p>CSystem / MainSystem: a multibody system which consists of nodes, objects, markers, loads, etc.</p></li>
<li><p>SystemContainer: holds a set of systems; connects to visualization (container)</p></li>
<li><p>items: node, (computational) object, marker, load, sensor</p></li>
<li><p>computational objects: efficient objects for computation = bodies, connectors, connectors, loads, nodes, …</p></li>
<li><p>visualization objects: interface between computational objects and 3D graphics</p></li>
<li><p>main (manager) objects: do all tasks (e.g. interface to visualization objects, GUI, Python, …) which are not needed during computation</p></li>
<li><p>static solver, kinematic solver, time integration</p></li>
<li><p>Python interface via pybind11; items are accessed with a dictionary interface; system structures and settings read/written by direct access to the structure (e.g. SimulationSettings, VisualizationSettings)</p></li>
<li><p>interfaces to linear solvers; future: optimizer, eigenvalue solver, … (mostly external or in Python)</p></li>
<li><p><strong>autogenerated</strong>: this folder in <code class="docutils literal notranslate"><span class="pre">main/src</span></code> contains many item definitions as well as other interface files; they are all automatically generated by some Python code and should not be changed manually as they will be overwritten.</p></li>
</ul>
</section>
<section id="c-code-modules">
<h2>C++ Code: Modules<a class="headerlink" href="#c-code-modules" title="Permalink to this heading"></a></h2>
<p>The following internal modules are used, which are represented by directories in <code class="docutils literal notranslate"><span class="pre">main/src</span></code>:</p>
<ul class="simple">
<li><p>Autogenerated: item (nodes, objects, markers and loads) classes split into main (management, Python connection), visualization and computation</p></li>
<li><p>Graphics: a general data structure for 2D and 3D graphical objects and a tiny openGL visualization; linkage to GLFW</p></li>
<li><p>Linalg: Linear algebra with vectors and matrices; separate classes for small vectors (SlimVector), large vectors (Vector and ResizableVector), vectors without copying data (LinkedDataVector), and vectors with constant size (ConstVector)</p></li>
<li><p>Main: mainly contains SystemContainer, System and ObjectFactory</p></li>
<li><p>Objects: contains the implementation part of the autogenerated items</p></li>
<li><p>Pymodules: manually created libraries for linkage to Python via pybind; remaining linking to Python is located in autogenerated folder</p></li>
<li><p>pythonGenerator: contains Python files for automatic generation of C++ interfaces and Python interfaces of items;</p></li>
<li><p>Solver: contains all solvers for solving a CSystem</p></li>
<li><p>System: contains core item files (e.g., MainNode, CNode, MainObject, CObject, …)</p></li>
<li><p>Tests: files for testing of internal linalg (vector/matrix), data structure libraries (array, etc.) and functions</p></li>
<li><p>Utilities: array structures for administrative/managing tasks (indexes of objects … bodies, forces, connectors, …); basic classes with templates and definitions</p></li>
</ul>
<p>The following main external libraries are linked to Exudyn:</p>
<ul class="simple">
<li><p>LEST: for testing of internal functions (e.g. linalg)</p></li>
<li><p>GLFW: 3D graphics with openGL; cross-platform capabilities</p></li>
<li><p>Eigen: linear algebra for large matrices, linear solvers, sparse matrices and link to special solvers</p></li>
<li><p>pybind11: linking of C++ to Python</p></li>
</ul>
</section>
<section id="code-style-and-conventions">
<h2>Code style and conventions<a class="headerlink" href="#code-style-and-conventions" title="Permalink to this heading"></a></h2>
<p>This section provides general coding rules and conventions, partly applicable to the C++ and Python parts of the code. Many rules follow common conventions (e.g., google code style, but not always – see notation):</p>
<ul class="simple">
<li><p>write simple code (no complicated structures or uncommon coding)</p></li>
<li><p>write readable code (e.g., variables and functions with names that represent the content or functionality; AVOID abbreviations)</p></li>
<li><p>put a header in every file, according to Doxygen format</p></li>
<li><p>put a comment to every (global) function, member function, data member, template parameter</p></li>
<li><p>ALWAYS USE curly brackets for single statements in ‘if’, ‘for’, etc.; example: if (i&lt;n) i += 1;</p></li>
<li><p>use Doxygen-style comments (use ‘//!’ Qt style and ‘&#64; date’ with ‘&#64;’ instead of ‘' for commands)</p></li>
<li><p>use Doxygen (with preceeding ‘&#64;’) ‘test’ for tests, ‘todo’ for todos and ‘bug’ for bugs</p></li>
<li><p>USE 4-spaces-tab</p></li>
<li><p>use C++11 standards when appropriate, but not exhaustively</p></li>
<li><p>ONE class ONE file rule (except for some collectors of single implementation functions)</p></li>
<li><p>add complete unit test to every function (every file has link to LEST library)</p></li>
<li><p>avoid large classes (&gt;30 member functions; &gt; 15 data members)</p></li>
<li><p>split up god classes (&gt;60 member functions)</p></li>
<li><p>mark changed code with your name and date</p></li>
<li><p>REPLACE tabs by spaces: Extras-&gt;Options-&gt;C/C++-&gt;Tabstopps: tab stopp size = 4 (=standard) +  KEEP SPACES=YES</p></li>
</ul>
</section>
<section id="notation-conventions">
<h2>Notation conventions<a class="headerlink" href="#notation-conventions" title="Permalink to this heading"></a></h2>
<p>The following notation conventions are applied (<strong>no exceptions!</strong>):</p>
<ul class="simple">
<li><p>use lowerCamelCase for names of variables (including class member variables), consts, c-define variables, …; EXCEPTION: for algorithms following formulas, e.g., <span class="math notranslate nohighlight">\(f = M*q_{tt} + K*q\)</span>, GBar, …</p></li>
<li><p>use UpperCamelCase for functions, classes, structs, …</p></li>
<li><p>Special cases for CamelCase (with some exceptions that happened in the past …):</p></li>
<li><p>continue upper case after upper case abbreviations in case of <strong>functions or classes</strong>: ‘ODESystem’, ‘Point2DClass’, ‘ANCFCable2D’, ‘ANCFALE’, ‘ComputeODE1Equations’, … (this is not always nice to read, but has become a standard and will be further used!)</p></li>
<li><p>for variables and class member variables continue <strong>lower case</strong>: ‘nODE1variables’, ‘dim2Dspecial’, ‘ANCFsize’</p></li>
<li><p>abbreviations at beginning of expressions: for functions or classes use <code class="docutils literal notranslate"><span class="pre">ODEComputeCoords()</span></code>, for variables avoid ‘ODE’ at beginning: use ‘nODE’ or write ‘odeCoordinates’</p></li>
<li><p>‘[…]Init’ … in arguments, for initialization of variables; e.g. ‘valueInit’ for initialization of member variable ‘value’</p></li>
<li><p>use American English throughout: Visualization, etc.</p></li>
<li><p>AVOID consecutive capitalized words, e.g., avoid ‘ODEAE’</p></li>
<li><p>do not use ‘_’ within variable or function names; exception: derivatives</p></li>
<li><p>use name which exactly describes the function/variable: ‘numberOfItems’ instead of ‘size’ or ‘l’</p></li>
<li><p>examples for variable names: secondOrderSize, massMatrix, mThetaTheta</p></li>
<li><p>examples for function/class names: <code class="docutils literal notranslate"><span class="pre">SecondOrderSize</span></code>, <code class="docutils literal notranslate"><span class="pre">EvaluateMassMatrix</span></code>, <code class="docutils literal notranslate"><span class="pre">Position(const</span> <span class="pre">Vector3D\&amp;</span> <span class="pre">localPosition)</span></code></p></li>
<li><p>use the Get/Set…() convention if data is retrieved from a class (Get) or something is set in a class (Set); Use <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">T\&amp;</span> <span class="pre">Get()/T\&amp;</span> <span class="pre">Get</span></code> if direct access to variables is needed; Use Get/Set for pybind11</p></li>
<li><p>example Get/Set: <code class="docutils literal notranslate"><span class="pre">Real*</span> <span class="pre">GetDataPointer()</span></code>, <code class="docutils literal notranslate"><span class="pre">Vector::SetAll(Real)</span></code>, <code class="docutils literal notranslate"><span class="pre">GetTransposed()</span></code>, <code class="docutils literal notranslate"><span class="pre">SetRotationalParameters(...)</span></code>, <code class="docutils literal notranslate"><span class="pre">SetColor(...)</span></code>, …</p></li>
<li><p>use ‘Real’ instead of double or float: for compatibility, also for AVX with SP/DP</p></li>
<li><p>use ‘Index’ for array/vector size and index instead of size_t or int</p></li>
<li><p>item: object, node, marker, load: anything handled within the computational/visualization systems</p></li>
<li><p>Do not use numbers (3 for 3D or any other number which represents, e.g., the number of rotation parameters). Use const Index or constexpr to define constants.</p></li>
</ul>
</section>
<section id="no-abbreviations-rule">
<h2>No-abbreviations-rule<a class="headerlink" href="#no-abbreviations-rule" title="Permalink to this heading"></a></h2>
<p>The code uses a <strong>minimum set of abbreviations</strong>; however, the following abbreviation rules are used throughout:
In general: DO NOT ABBREVIATE function, class or variable names: GetDataPointer() instead of GetPtr(); exception: cnt, i, j, k, x or v in cases where it is really clear (short, 5-line member functions).</p>
<p><strong>Exceptions</strong> to the NO-ABBREVIATIONS-RULE, see also hyperref[sec:listOfAbbreviations]underlineList of Abbreviations:</p>
<ul class="simple">
<li><p><a class="reference internal" href="Abbreviations.html#ode"><span class="std std-ref">ODE</span></a></p></li>
<li><p><a class="reference internal" href="Abbreviations.html#ode2"><span class="std std-ref">ODE2</span></a>: marks parts related to second order differential equations (SOS2, EvalF2 in HOTINT)</p></li>
<li><p><a class="reference internal" href="Abbreviations.html#ode1"><span class="std std-ref">ODE1</span></a>: marks parts related to first order differential equations (ES, EvalF in HOTINT)</p></li>
<li><p><a class="reference internal" href="Abbreviations.html#ae"><span class="std std-ref">AE</span></a>; note: using the term ‘AEcoordinates’ for ‘algebraicEquationsCoordinates’</p></li>
<li><p>‘C[…]’ … Computational, e.g. for ComputationalNode ==&gt; use ‘CNode’</p></li>
<li><p><a class="reference internal" href="Abbreviations.html#mbs"><span class="std std-ref">mbs</span></a></p></li>
<li><p><a class="reference internal" href="Abbreviations.html#min"><span class="std std-ref">min</span></a>, <a class="reference internal" href="Abbreviations.html#max"><span class="std std-ref">max</span></a></p></li>
<li><p><a class="reference internal" href="Abbreviations.html#abs"><span class="std std-ref">abs</span></a>, <a class="reference internal" href="Abbreviations.html#rel"><span class="std std-ref">rel</span></a></p></li>
<li><p><a class="reference internal" href="Abbreviations.html#trig"><span class="std std-ref">trig</span></a></p></li>
<li><p><a class="reference internal" href="Abbreviations.html#quad"><span class="std std-ref">quad</span></a></p></li>
<li><p><a class="reference internal" href="Abbreviations.html#rhs"><span class="std std-ref">RHS</span></a></p></li>
<li><p><a class="reference internal" href="Abbreviations.html#lhs"><span class="std std-ref">LHS</span></a></p></li>
<li><p><a class="reference internal" href="Abbreviations.html#ep"><span class="std std-ref">EP</span></a></p></li>
<li><p><a class="reference internal" href="Abbreviations.html#rxyz"><span class="std std-ref">Rxyz</span></a></p></li>
<li><p><a class="reference internal" href="Abbreviations.html#coeffs"><span class="std std-ref">coeffs</span></a></p></li>
<li><p><a class="reference internal" href="Abbreviations.html#pos"><span class="std std-ref">pos</span></a></p></li>
<li><p><a class="reference internal" href="Abbreviations.html#t66"><span class="std std-ref">T66</span></a>; based on <span class="math notranslate nohighlight">\(6\times 6\)</span> matrix transformations</p></li>
<li><p>write time derivatives with underscore: _t, _tt; example: Position_t, Position_tt, …</p></li>
<li><p>write space-wise derivatives ith underscore: _x, _xx, _y, …</p></li>
<li><p>if a scalar, write coordinate derivative with underscore: _q, _v (derivative w.r.t. velocity coordinates)</p></li>
<li><p>for components, elements or entries of vectors, arrays, matrices: use ‘item’ throughout</p></li>
<li><p>‘[…]Init’ … in arguments, for initialization of variables; e.g. ‘valueInit’ for initialization of member variable ‘value’</p></li>
</ul>
</section>
<section id="implementation-of-new-computational-items-in-c">
<h2>Implementation of new computational items in C++<a class="headerlink" href="#implementation-of-new-computational-items-in-c" title="Permalink to this heading"></a></h2>
<p>This section should sketch which changes will be needed to integrate new C++ items.
In general, it is recommended to first start with a Python implementation with user functions based on
<code class="docutils literal notranslate"><span class="pre">NodeGeneric...</span></code>, <code class="docutils literal notranslate"><span class="pre">ObjectGeneric...</span></code>, <code class="docutils literal notranslate"><span class="pre">ObjectConnectorCoordinateVector</span></code> for constraints and
any suitable connector for new nodes or objects. New sensors can be based on the <code class="docutils literal notranslate"><span class="pre">SensorUserFunction</span></code>.</p>
<p>If such an implementation is successful, but too slow, a C++ implementation can be considered.
In the following, two use cases are shown, which show the simplicity of the procedure:</p>
<ul class="simple">
<li><p><strong>Case 1</strong>: user object (body):</p></li>
</ul>
<blockquote>
<div><p>It is recommended to first search for a body with a similar behavior.
Copy the definition of such an object inside the file <code class="docutils literal notranslate"><span class="pre">objectDefinition.py</span></code> and edit the according lines.
There is not much description of
this file yet (except from the first lines of the file), as it will be transformed into another format in the future.
Basically, you need to edit the interface, which contains parameters (which are linked to Python) and functions,
which go to the header file.
When you finished editing, run <code class="docutils literal notranslate"><span class="pre">pythonAutoGenerateObjects.py</span></code>. This generates the header file in <code class="docutils literal notranslate"><span class="pre">src/autogenerated</span></code>but also adds description to some docs files and adds the <code class="docutils literal notranslate"><span class="pre">pybind11</span></code> interface.
Now copy the implementation (<code class="docutils literal notranslate"><span class="pre">.cpp</span></code>) file of the same connector from which you copied from and rename and edit all functions.
For the body</p>
</div></blockquote>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ComputeMassMatrix</span></code>: computes the mass matrix either in sparse or dense mode; this function is performance-critical if the mass matrix is non-constant</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ComputeODE2LHS</span></code>: computes the <a class="reference internal" href="Abbreviations.html#lhs"><span class="std std-ref">LHS</span></a> generalized forces of the body; this function is performance-critical</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GetAccessFunctionTypes</span></code>: specifies, which access functions are available in <code class="docutils literal notranslate"><span class="pre">GetAccessFunctionBody(...)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GetAccessFunctionBody</span></code>: needs to compute functions for ‘access’ to the body, in the sense that e.g. forces or torques can be applied.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GetAvailableJacobians</span></code>: shall return the flags which jacobians of <code class="docutils literal notranslate"><span class="pre">ComputeODE2LHS</span></code> need to be computed and which are available as functions; binary flags added up</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GetOutputVariableBody</span></code>: function needs to implement the output variables, such as position, acceleration, forces, etc. as defined in <code class="docutils literal notranslate"><span class="pre">GetOutputVariableTypes()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HasConstantMassMatrix</span></code>: specifies, if mass matrix is constant</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GetNumberOfNodes</span></code>: number of nodes of object</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GetODE2Size</span></code>: total number of <a class="reference internal" href="Abbreviations.html#ode2"><span class="std std-ref">ODE2</span></a> coordinates</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GetType</span></code>: some flags for objects, such as <code class="docutils literal notranslate"><span class="pre">Body</span></code>, <code class="docutils literal notranslate"><span class="pre">SingleNoded</span></code>, <code class="docutils literal notranslate"><span class="pre">SuperElement</span></code>, …; these flags are needed for connectivity and special treatment in the system</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GetPosition,</span> <span class="pre">GetVelocity,</span> <span class="pre">...</span></code>: provide this functions as far as possible; rigid bodies need to provide positions and rotation matrix, as well as velocity and angular velocity for markers; if functions do not exist, some marker or sensor functions may fail</p></li>
<li><p>…   possibly some helper functions, which you should implement for the functionality of your object.</p></li>
<li><p><strong>Case 2</strong>: user connector:</p></li>
</ul>
<blockquote>
<div><p>It is recommended to search for a connector with similar behavior; first check, if you would like to implement
an algebraic constraint or a spring-damper-like connector.
Again, copy a similar connector in <code class="docutils literal notranslate"><span class="pre">objectDefinition.py</span></code> and edit the according lines.
When you finished editing, run <code class="docutils literal notranslate"><span class="pre">pythonAutoGenerateObjects.py</span></code> and make a copy of the copied implementation (<code class="docutils literal notranslate"><span class="pre">.cpp</span></code>) file.
The implementation file usually consists of</p>
</div></blockquote>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ComputeODE2LHS</span></code>: this function shall compute the <a class="reference internal" href="Abbreviations.html#lhs"><span class="std std-ref">LHS</span></a> generalized forces on the two marker objects</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ComputeJacobianODE2_ODE2</span></code>: computes the <code class="docutils literal notranslate"><span class="pre">GetAvailableJacobians()</span></code> is not providing any ‘…_function’ flag, which indicates that these jacobians are available as function</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GetOutputVariableConnector</span></code>: this function needs to compute all output variables as given in <code class="docutils literal notranslate"><span class="pre">GetOutputVariableTypes()</span></code></p></li>
<li><p>…   possibly some helper functions, which you should implement for the functionality of your object.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="AdvancedTopics.html" class="btn btn-neutral float-left" title="Advanced topics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="TutorialIndex.html" class="btn btn-neutral float-right" title="Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>