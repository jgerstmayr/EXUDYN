<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Exudyn Basics &mdash; Exudyn 1.5.97.dev1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/rtd_sphinx_search.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/js/rtd_sphinx_search.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Advanced topics" href="AdvancedTopics.html" />
    <link rel="prev" title="Mapping between local and global coordinate indices" href="MappingBetweenLocalAndGlobalCoordinateIndices.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Exudyn
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Exudyn User Manual</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Exudyn.html">Exudyn</a></li>
<li class="toctree-l1"><a class="reference internal" href="InstallationAndGettingStartedIndex.html">Installation and Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="OverviewOnExudynIndex.html">Overview on Exudyn</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="OverviewOnExudyn.html">Overview on Exudyn</a></li>
<li class="toctree-l2"><a class="reference internal" href="ModuleStructure.html">Module structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="ItemsNodesObjectsLoadsMarkersSensors.html">Items: Nodes, Objects, Loads, Markers, Sensors, …</a></li>
<li class="toctree-l2"><a class="reference internal" href="MappingBetweenLocalAndGlobalCoordinateIndices.html">Mapping between local and global coordinate indices</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Exudyn Basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#interaction-with-the-exudyn-module">Interaction with the Exudyn module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation-settings">Simulation settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-output-and-results">Generating output and results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualization-settings-dialog">Visualization settings dialog</a></li>
<li class="toctree-l3"><a class="reference internal" href="#renderer-and-3d-graphics">Renderer and 3D graphics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graphics-pipeline">Graphics pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storing-the-model-view">Storing the model view</a></li>
<li class="toctree-l3"><a class="reference internal" href="#graphics-user-functions-via-python">Graphics user functions via Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="#color-rgba-and-alpha-transparency">Color, RGBA and alpha-transparency</a></li>
<li class="toctree-l3"><a class="reference internal" href="#solution-viewer">Solution viewer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-animations">Generating animations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples-test-models-and-test-suite">Examples, test models and test suite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#removing-convergence-problems-and-solver-failures">Removing convergence problems and solver failures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance-and-ways-to-speed-up-computations">Performance and ways to speed up computations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AdvancedTopics.html">Advanced topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="CCode.html">C++ Code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="TutorialIndex.html">Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pythonUtilities/index.html">Python Utility Functions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Issue Tracker</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../trackerlogRST.html">Issue tracker</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Exudyn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="OverviewOnExudynIndex.html">Overview on Exudyn</a></li>
      <li class="breadcrumb-item active">Exudyn Basics</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/RST/ExudynBasics.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="exudyn-basics">
<h1>Exudyn Basics<a class="headerlink" href="#exudyn-basics" title="Permalink to this heading"></a></h1>
<p>This section will show:</p>
<ul class="simple">
<li><p>Interaction with the Exudyn module</p></li>
<li><p>Simulation settings</p></li>
<li><p>Visualization settings</p></li>
<li><p>Generating output and results</p></li>
<li><p>Graphics pipeline</p></li>
<li><p>Generating animations</p></li>
</ul>
<section id="interaction-with-the-exudyn-module">
<h2>Interaction with the Exudyn module<a class="headerlink" href="#interaction-with-the-exudyn-module" title="Permalink to this heading"></a></h2>
<p>It is important that the Exudyn module is basically a state machine, where you create items on the C++ side using the Python interface. This helps you to easily set up models using many other Python modules (numpy, sympy, matplotlib, …) while the computation will be performed in the end on the C++ side in a very efficient manner.</p>
<p><strong>Where do objects live?</strong></p>
<p>Whenever a system container is created with <code class="docutils literal notranslate"><span class="pre">SC</span> <span class="pre">=</span> <span class="pre">exu.SystemContainer()</span></code>, the structure <code class="docutils literal notranslate"><span class="pre">SC</span></code> becomes a variable in the Python interpreter, but it is managed inside the C++ code and it can be modified via the Python interface.
Usually, the system container will hold at least one system, usually called <code class="docutils literal notranslate"><span class="pre">mbs</span></code>.
Commands such as <code class="docutils literal notranslate"><span class="pre">mbs.AddNode(...)</span></code> add objects to the system <code class="docutils literal notranslate"><span class="pre">mbs</span></code>.
The system will be prepared for simulation by <code class="docutils literal notranslate"><span class="pre">mbs.Assemble()</span></code> and can be solved (e.g., using <code class="docutils literal notranslate"><span class="pre">exu.SolveDynamic(...)</span></code>) and evaluated hereafter using the results files.
Using <code class="docutils literal notranslate"><span class="pre">mbs.Reset()</span></code> will clear the system and allows to set up a new system. Items can be modified (<code class="docutils literal notranslate"><span class="pre">ModifyObject(...)</span></code>) after first initialization, even during simulation.</p>
</section>
<section id="simulation-settings">
<h2>Simulation settings<a class="headerlink" href="#simulation-settings" title="Permalink to this heading"></a></h2>
<p>The simulation settings consists of a couple of substructures, e.g., for <code class="docutils literal notranslate"><span class="pre">solutionSettings</span></code>, <code class="docutils literal notranslate"><span class="pre">staticSolver</span></code>, <code class="docutils literal notranslate"><span class="pre">timeIntegration</span></code> as well as a couple of general options – for details see Sections [theDoc.pdf] – [theDoc.pdf].</p>
<p>Simulation settings are needed for every solver. They contain solver-specific parameters (e.g., the way how load steps are applied), information on how solution files are written, and very specific control parameters, e.g., for the Newton solver.</p>
<p>The simulation settings structure is created with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">simulationSettings</span> <span class="o">=</span> <span class="n">exu</span><span class="o">.</span><span class="n">SimulationSettings</span><span class="p">()</span>
</pre></div>
</div>
<p>Hereafter, values of the structure can be modified, e.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tEnd</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">#10 seconds of simulation time:</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1">#step size (gives 1000 steps)</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">timeIntegration</span><span class="o">.</span><span class="n">endTime</span> <span class="o">=</span> <span class="n">tEnd</span>
<span class="c1">#steps for time integration must be integer:</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">timeIntegration</span><span class="o">.</span><span class="n">numberOfSteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tEnd</span><span class="o">/</span><span class="n">h</span><span class="p">)</span>
<span class="c1">#assigns a new tolerance for Newton&#39;s method:</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">timeIntegration</span><span class="o">.</span><span class="n">newton</span><span class="o">.</span><span class="n">relativeTolerance</span> <span class="o">=</span> <span class="mf">1e-9</span>
<span class="c1">#write some output while the solver is active (SLOWER):</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">timeIntegration</span><span class="o">.</span><span class="n">verboseMode</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1">#write solution every 0.1 seconds:</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">solutionSettings</span><span class="o">.</span><span class="n">solutionWritePeriod</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="c1">#use sparse matrix storage and solver (package Eigen):</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">linearSolverType</span> <span class="o">=</span> <span class="n">exu</span><span class="o">.</span><span class="n">LinearSolverType</span><span class="o">.</span><span class="n">EigenSparse</span>
</pre></div>
</div>
</section>
<section id="generating-output-and-results">
<h2>Generating output and results<a class="headerlink" href="#generating-output-and-results" title="Permalink to this heading"></a></h2>
<p>The solvers provide a number of options in <code class="docutils literal notranslate"><span class="pre">solutionSettings</span></code> to generate a solution file. As a default, exporting the solution of all system coordinates (on position, velocity, … level) to the solution file is activated with a writing period of 0.01 seconds.</p>
<p>Typical output settings are:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#create a new simulationSettings structure:</span>
<span class="n">simulationSettings</span> <span class="o">=</span> <span class="n">exu</span><span class="o">.</span><span class="n">SimulationSettings</span><span class="p">()</span>

<span class="c1">#activate writing to solution file:</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">solutionSettings</span><span class="o">.</span><span class="n">writeSolutionToFile</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1">#write results every 1ms:</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">solutionSettings</span><span class="o">.</span><span class="n">solutionWritePeriod</span> <span class="o">=</span> <span class="mf">0.001</span>

<span class="c1">#assign new filename to solution file</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">solutionSettings</span><span class="o">.</span><span class="n">coordinatesSolutionFileName</span><span class="o">=</span> <span class="s2">&quot;myOutput.txt&quot;</span>

<span class="c1">#do not export certain coordinates:</span>
<span class="n">simulationSettings</span><span class="o">.</span><span class="n">solutionSettings</span><span class="o">.</span><span class="n">exportDataCoordinates</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Furthermore, you can use sensors to record particular information, e.g., the displacement of a body’s local
position, forces or joint data. For viewing sensor results, use the <code class="docutils literal notranslate"><span class="pre">PlotSensor</span></code> function of the
<code class="docutils literal notranslate"><span class="pre">exudyn.plot</span></code> tool, see the rigid body and joints tutorial.</p>
</section>
<section id="visualization-settings-dialog">
<h2>Visualization settings dialog<a class="headerlink" href="#visualization-settings-dialog" title="Permalink to this heading"></a></h2>
<p>Visualization settings are used for user interaction with the model. E.g., the nodes, markers, loads, etc., can be visualized for every model. There are default values, e.g., for the size of nodes, which may be inappropriate for your model. Therefore, you can adjust those parameters. In some cases, huge models require simpler graphics representation, in order not to slow down performance – e.g., the number of faces to represent a cylinder should be small if there are 10000s of cylinders drawn. Even computation performance can be slowed down, if visualization takes lots of CPU power. However, visualization is performed in a separate thread, which usually does not influence the computation exhaustively.</p>
<p>Details on visualization settings and its substructures are provided in Sections [theDoc.pdf] – [theDoc.pdf]. These settings may also be edited by pressing ‘V’ in the active render window (does not work, if there is no active render loop using, e.g., <code class="docutils literal notranslate"><span class="pre">SC.WaitForRenderEngineStopFlag()</span></code> or
<code class="docutils literal notranslate"><span class="pre">mbs.WaitForUserToContinue()</span></code> ).</p>
<p>Note that this dialog is automatically created and uses Python’s <code class="docutils literal notranslate"><span class="pre">tkinter</span></code>, which is lightweight, but not very well suited if display scalings are large (e.g., on high resolution laptop screens). If working with Spyder, it is recommended to restart Spyder, if display scaling is changed, in order to adjust scaling not only for Spyder but also for Exudyn .</p>
<p>The appearance of visualization settings dialogs may be adjusted by directly modifying <code class="docutils literal notranslate"><span class="pre">exudyn.GUI</span></code> variables (this may change in the future). For example write in your code before opening the render window (treeEdit and treeview both mean the settings dialog currently used for visualization settings and partially for right-mouse-click):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">exudyn.GUI</span>
<span class="n">exudyn</span><span class="o">.</span><span class="n">GUI</span><span class="o">.</span><span class="n">dialogDefaultWidth</span>             <span class="c1">#unscaled width of, e.g., right-mouse-button dialog</span>
<span class="n">exudyn</span><span class="o">.</span><span class="n">GUI</span><span class="o">.</span><span class="n">treeEditDefaultWidth</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">exudyn</span><span class="o">.</span><span class="n">GUI</span><span class="o">.</span><span class="n">treeEditDefaultHeight</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">exudyn</span><span class="o">.</span><span class="n">GUI</span><span class="o">.</span><span class="n">treeEditMaxInitialHeight</span> <span class="o">=</span> <span class="mi">600</span> <span class="c1">#otherwise height is increased for larger screens</span>
<span class="n">exudyn</span><span class="o">.</span><span class="n">GUI</span><span class="o">.</span><span class="n">treeEditOpenItems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;general&#39;</span><span class="p">,</span><span class="s1">&#39;contact&#39;</span><span class="p">]</span> <span class="c1">#these tree items are opened each time the dialog is opened</span>
<span class="c1">#</span>
<span class="n">exudyn</span><span class="o">.</span><span class="n">GUI</span><span class="o">.</span><span class="n">treeviewDefaultFontSize</span>        <span class="c1">#this is the base font size of the dialog (also right-mouse-button dialog)</span>
<span class="n">exudyn</span><span class="o">.</span><span class="n">GUI</span><span class="o">.</span><span class="n">useRenderWindowDisplayScaling</span>  <span class="c1">#if True, the scaling will follow the current scaling of the render window; if False, it will use the \ ``tkinter``\  internal scaling, which uses the main screen where the dialog is created (which won&#39;t scale well, if the window is moved to another screen).</span>
<span class="c1">#</span>
<span class="n">exudyn</span><span class="o">.</span><span class="n">GUI</span><span class="o">.</span><span class="n">textHeightFactor</span> <span class="o">=</span> <span class="mf">1.45</span>        <span class="c1">#this factor is used to increase height of lines in tree view as compared to font size</span>
</pre></div>
</div>
<p><a class="reference internal" href="../../_images/visualizationSettings.png"><img alt="picVisSettings" src="../../_images/visualizationSettings.png" style="width: 60%;" /></a></p>
<p>[View of visualization settings (press ‘V’ in render window to open dialog).]</p>
<p>The visualization settings structure can be accessed in the system container <code class="docutils literal notranslate"><span class="pre">SC</span></code> (access per reference, no copying!), accessing every value or structure directly, e.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SC</span><span class="o">.</span><span class="n">visualizationSettings</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">defaultSize</span> <span class="o">=</span> <span class="mf">0.001</span>      <span class="c1">#draw nodes very small</span>

<span class="c1">#change openGL parameters; current values can be obtained from SC.GetRenderState()</span>
<span class="c1">#change zoom factor:</span>
<span class="n">SC</span><span class="o">.</span><span class="n">visualizationSettings</span><span class="o">.</span><span class="n">openGL</span><span class="o">.</span><span class="n">initialZoom</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="c1">#set the center point of the scene (can be attached to moving object):</span>
<span class="n">SC</span><span class="o">.</span><span class="n">visualizationSettings</span><span class="o">.</span><span class="n">openGL</span><span class="o">.</span><span class="n">initialCenterPoint</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.192</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0039</span><span class="p">,</span><span class="o">-</span><span class="mf">0.075</span><span class="p">]</span>

<span class="c1">#turn of auto-fit:</span>
<span class="n">SC</span><span class="o">.</span><span class="n">visualizationSettings</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">autoFitScene</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1">#change smoothness of a cylinder:</span>
<span class="n">SC</span><span class="o">.</span><span class="n">visualizationSettings</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">cylinderTiling</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1">#make round objects flat:</span>
<span class="n">SC</span><span class="o">.</span><span class="n">visualizationSettings</span><span class="o">.</span><span class="n">openGL</span><span class="o">.</span><span class="n">shadeModelSmooth</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1">#turn on coloured plot, using y-component of displacements:</span>
<span class="n">SC</span><span class="o">.</span><span class="n">visualizationSettings</span><span class="o">.</span><span class="n">contour</span><span class="o">.</span><span class="n">outputVariable</span> <span class="o">=</span> <span class="n">exu</span><span class="o">.</span><span class="n">OutputVariableType</span><span class="o">.</span><span class="n">Displacement</span>
<span class="n">SC</span><span class="o">.</span><span class="n">visualizationSettings</span><span class="o">.</span><span class="n">contour</span><span class="o">.</span><span class="n">outputVariableComponent</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#0=x, 1=y, 2=z</span>
</pre></div>
</div>
</section>
<section id="renderer-and-3d-graphics">
<h2>Renderer and 3D graphics<a class="headerlink" href="#renderer-and-3d-graphics" title="Permalink to this heading"></a></h2>
<p>A 3D renderer is attached to the simulation. Visualization is started with  <code class="docutils literal notranslate"><span class="pre">exu.StartRenderer()</span></code>, see the examples and tutorials.
The renderer uses an OpenGL window of a library called GLFW, which is platform-independent.
The renderer is set up in a minimalistic way, just to ensure that you can check that the modeling is correct. There is no way to contruct models with the renderer. Try to avoid huge number of triangles in STL files or by creating large number of complex objects, such as spheres or cylinders.</p>
<p>There are some main features in the renderer, using keyboard and mouse:</p>
<ul class="simple">
<li><p>press key H to show help in renderer</p></li>
<li><p>move model by pressing left mouse button and drag</p></li>
<li><p>rotate model by pressing right mouse button and drag</p></li>
<li><p>change visibility (wire frame, solid, transparent, …) by pressing T</p></li>
<li><p>zoom all: key A</p></li>
<li><p>open visualization dialog: key V</p></li>
<li><p>show item number: click on graphics element with left mouse button</p></li>
<li><p>show item dictionary: click on graphics element with right mouse button</p></li>
<li><p>… (see theDoc.pdfff.)</p></li>
</ul>
<p>Depending on your model (size, place, …), you may need to adjust the following <code class="docutils literal notranslate"><span class="pre">openGL</span></code> parameters in <code class="docutils literal notranslate"><span class="pre">visualizationSettings</span></code>:</p>
<ul class="simple">
<li><p>light and light position</p></li>
<li><p>shadow (turned off by using 0; turned on by using, e.g., a value of 0.3) and shadow polygon offset; shadow slows down graphics performance by a factor of 2-3, depending on your graphics card</p></li>
<li><p>visibility of nodes, markers, etc. in according bodies, nodes, markers, …, <code class="docutils literal notranslate"><span class="pre">visualizationSettings</span></code></p></li>
<li><p>move camera with a selected marker: adjust <code class="docutils literal notranslate"><span class="pre">trackMarker</span></code> in <code class="docutils literal notranslate"><span class="pre">visualizationSettings.interactive</span></code></p></li>
<li><p>… (see theDoc.pdfff.)</p></li>
</ul>
</section>
<section id="graphics-pipeline">
<h2>Graphics pipeline<a class="headerlink" href="#graphics-pipeline" title="Permalink to this heading"></a></h2>
<p>There are basically two loops during simulation, which feed the graphics pipeline.
The solver runs a loop:</p>
<ul class="simple">
<li><p>compute step (or set up initial values)</p></li>
<li><p>finish computation step; results are in current state</p></li>
<li><p>copy current state to visualization state (thread safe)</p></li>
<li><p>signal graphics pipeline that new visualization data is available</p></li>
<li><p>the renderer may update the visualization depending on <code class="docutils literal notranslate"><span class="pre">graphicsUpdateInterval</span></code> in <code class="docutils literal notranslate"><span class="pre">visualizationSettings.general</span></code></p></li>
</ul>
<p>The openGL graphics thread (=separate thread) runs the following loop:</p>
<ul class="simple">
<li><p>render openGL scene with a given graphicsData structure (containing lines, faces, text, …)</p></li>
<li><p>go idle for some milliseconds</p></li>
<li><p>check if openGL rendering needs an update (e.g. due to user interaction)
=&gt; if update is needed, the visualization of all items is updated – stored in a graphicsData structure)</p></li>
<li><p>check if new visualization data is available and the time since last update is larger than a presribed value, the graphicsData structure is updated with the new visualization state</p></li>
</ul>
</section>
<section id="storing-the-model-view">
<h2>Storing the model view<a class="headerlink" href="#storing-the-model-view" title="Permalink to this heading"></a></h2>
<p>There is a simple way to store the current view (zoom, centerpoint, orientation, etc.) by using <code class="docutils literal notranslate"><span class="pre">SC.GetRenderState()</span></code> and <code class="docutils literal notranslate"><span class="pre">SC.SetRenderState()</span></code>,
see also theDoc.pdf.
A simple way is to reload the stored render state (model view) after simulating your model once at the end of the simulation (
note that <code class="docutils literal notranslate"><span class="pre">visualizationSettings.general.autoFitScene</span></code> should be set False if you want to use the stored zoom factor):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">exudyn</span> <span class="k">as</span> <span class="nn">exu</span>
<span class="n">SC</span><span class="o">=</span><span class="n">exu</span><span class="o">.</span><span class="n">SystemContainer</span><span class="p">()</span>
<span class="n">SC</span><span class="o">.</span><span class="n">visualizationSettings</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">autoFitScene</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#prevent from autozoom</span>
<span class="n">exu</span><span class="o">.</span><span class="n">StartRenderer</span><span class="p">()</span>
<span class="k">if</span> <span class="s1">&#39;renderState&#39;</span> <span class="ow">in</span> <span class="n">exu</span><span class="o">.</span><span class="n">sys</span><span class="p">:</span>
    <span class="n">SC</span><span class="o">.</span><span class="n">SetRenderState</span><span class="p">(</span><span class="n">exu</span><span class="o">.</span><span class="n">sys</span><span class="p">[</span><span class="s1">&#39;renderState&#39;</span><span class="p">])</span>
<span class="c1">#+++++++++++++++</span>
<span class="c1">#do simulation here and adjust model view settings with mouse</span>
<span class="c1">#+++++++++++++++</span>

<span class="c1">#store model view for next run:</span>
<span class="n">StopRenderer</span><span class="p">()</span> <span class="c1">#stores render state in exu.sys[&#39;renderState&#39;]</span>
</pre></div>
</div>
<p>Alternatively, you can obtain the current model view from the console after a simulation, e.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">SC</span><span class="o">.</span><span class="n">GetRenderState</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<span class="s1">&#39;centerPoint&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
 <span class="s1">&#39;maxSceneSize&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
 <span class="s1">&#39;zoom&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
 <span class="s1">&#39;currentWindowSize&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">],</span>
 <span class="s1">&#39;modelRotation&#39;</span><span class="p">:</span> <span class="p">[[</span> <span class="mf">0.34202015</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">,</span> <span class="mf">0.9396926</span> <span class="p">],</span>
                   <span class="p">[</span><span class="o">-</span><span class="mf">0.60402274</span><span class="p">,</span>  <span class="mf">0.76604444</span><span class="p">,</span> <span class="mf">0.21984631</span><span class="p">],</span>
                   <span class="p">[</span><span class="o">-</span><span class="mf">0.7198463</span> <span class="p">,</span> <span class="o">-</span><span class="mf">0.6427876</span> <span class="p">,</span> <span class="mf">0.26200265</span><span class="p">]])</span>
</pre></div>
</div>
<p>which contains the last state of the renderer.
Now copy the output and set this with <code class="docutils literal notranslate"><span class="pre">SC.SetRenderState</span></code> in your Python code to have a fixed model view in every simulation (<code class="docutils literal notranslate"><span class="pre">SC.SetRenderState</span></code> AFTER <code class="docutils literal notranslate"><span class="pre">exu.StartRenderer()</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">SC</span><span class="o">.</span><span class="n">visualizationSettings</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">autoFitScene</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#prevent from autozoom</span>
<span class="n">exu</span><span class="o">.</span><span class="n">StartRenderer</span><span class="p">()</span>
<span class="n">renderState</span><span class="o">=</span><span class="s1">&#39;centerPoint&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
             <span class="s1">&#39;maxSceneSize&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
             <span class="s1">&#39;zoom&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
             <span class="s1">&#39;currentWindowSize&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">],</span>
             <span class="s1">&#39;modelRotation&#39;</span><span class="p">:</span>     <span class="p">[[</span> <span class="mf">0.34202015</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">,</span>  <span class="mf">0.9396926</span> <span class="p">],</span>
                                  <span class="p">[</span><span class="o">-</span><span class="mf">0.60402274</span><span class="p">,</span>  <span class="mf">0.76604444</span><span class="p">,</span>  <span class="mf">0.21984631</span><span class="p">],</span>
                                  <span class="p">[</span><span class="o">-</span><span class="mf">0.7198463</span> <span class="p">,</span> <span class="o">-</span><span class="mf">0.6427876</span> <span class="p">,</span>  <span class="mf">0.26200265</span><span class="p">]])</span>
<span class="n">SC</span><span class="o">.</span><span class="n">SetRenderState</span><span class="p">(</span><span class="n">renderState</span><span class="p">)</span>
<span class="c1">#.... further code for simulation here</span>
</pre></div>
</div>
<p>Note that in the current version of Exudyn there is more data stored in render state, which is not used in <code class="docutils literal notranslate"><span class="pre">SC.SetRenderState</span></code>,
see also theDoc.pdf.</p>
</section>
<section id="graphics-user-functions-via-python">
<h2>Graphics user functions via Python<a class="headerlink" href="#graphics-user-functions-via-python" title="Permalink to this heading"></a></h2>
<p>There are some user functions in order to customize drawing:</p>
<ul class="simple">
<li><p>You can assign graphicsData to the visualization to most bodies, such as rigid bodies in order to change the shape. Graphics can also be imported from files (<code class="docutils literal notranslate"><span class="pre">GraphicsDataFromSTLfileTxt</span></code>) using the established format STL (STereoLithography or Standard Triangle Language; file format available in nearly all CAD systems).</p></li>
<li><p>Some objects, e.g., <code class="docutils literal notranslate"><span class="pre">ObjectGenericODE2</span></code> or <code class="docutils literal notranslate"><span class="pre">ObjectRigidBody</span></code>, provide customized a function <code class="docutils literal notranslate"><span class="pre">graphicsDataUserFunction</span></code>. This user function just returns a list of GraphicsData, see theDoc.pdf. With this function you can change the shape of the body in every step of the computation.</p></li>
<li><p>Specifically, the <code class="docutils literal notranslate"><span class="pre">graphicsDataUserFunction</span></code> in <code class="docutils literal notranslate"><span class="pre">ObjectGround</span></code> can be used to draw any moving background in the scene.</p></li>
</ul>
<p>Note that all kinds of <code class="docutils literal notranslate"><span class="pre">graphicsDataUserFunction</span></code>s need to be called from the main (=computation) process as Python functions may not be called from separate threads (GIL). Therefore, the computation thread is interrupted to execute the <code class="docutils literal notranslate"><span class="pre">graphicsDataUserFunction</span></code> between two time steps, such that the graphics Python user function can be executed. There is a timeout variable for this interruption of the computation with a warning if scenes get too complicated.</p>
</section>
<section id="color-rgba-and-alpha-transparency">
<h2>Color, RGBA and alpha-transparency<a class="headerlink" href="#color-rgba-and-alpha-transparency" title="Permalink to this heading"></a></h2>
<p>Many functions and objects include color information. In order to allow alpha-transparency, all colors contain a list of 4 RGBA values, all values being in the range [0..1]:</p>
<ul class="simple">
<li><p>red (R) channel</p></li>
<li><p>green (G) channel</p></li>
<li><p>blue (B) channel</p></li>
<li><p>alpha (A) value, representing the so-called <strong>alpha-transparency</strong> (A=0: fully transparent, A=1: solid)</p></li>
</ul>
<p>E.g., red color with no transparency is obtained by the color=[1,0,0,1]. Color predefinitions are found in <code class="docutils literal notranslate"><span class="pre">exudynGraphicsDataUtilities.py</span></code>, e.g., <code class="docutils literal notranslate"><span class="pre">color4red</span></code> or <code class="docutils literal notranslate"><span class="pre">color4steelblue</span></code> as well a list of 16 colors <code class="docutils literal notranslate"><span class="pre">color4list</span></code>, which is convenient to be used in a loop creating objects.</p>
</section>
<section id="solution-viewer">
<h2>Solution viewer<a class="headerlink" href="#solution-viewer" title="Permalink to this heading"></a></h2>
<p>Exudyn offers a convenient WYSIWYS – ‘What you See is What you Simulate’ interface, showing you the computation results during simulation in the render window.
If you are running large models, it may be more convenient to watch results after simulation has been finished.
For this, you can use</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">interactive.SolutionViewer</span></code>, see Section [theDoc.pdf]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">interactive.AnimateModes</span></code>, lets you view the animation of computed modes, see Section [theDoc.pdf]</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">SolutionViewer</span></code> adds a <code class="docutils literal notranslate"><span class="pre">tkinter</span></code> interactive dialog, which lets you interact with the model, with the following features:</p>
<ul class="simple">
<li><p>The SolutionViewer represents a ‘Player’ for the dynamic solution or a series of static solutions, which is available after simulation if <code class="docutils literal notranslate"><span class="pre">solutionSettings.writeSolutionToFile</span> <span class="pre">=</span> <span class="pre">True</span></code></p></li>
<li><p>The parameter <code class="docutils literal notranslate"><span class="pre">solutionSettings.solutionWritePeriod</span></code> represents the time period used to store solutions during dynamic computations.</p></li>
<li><p>As soon as ‘Run’ is pressed, the player runs (and it may be started automatically as well)</p></li>
<li><p>In the ‘Static’ mode, drag the slider ‘Solution steps’ to view the solution steps</p></li>
<li><p>In the ‘Continuous run’ mode, the player runs in an infinite loop</p></li>
<li><p>In the ‘One cycle’ mode, the player runs from the current position to the end; this is perfectly suited to record series of images for <strong>creating animations</strong>, see theDoc.pdf and works together with the visualization settings dialog.</p></li>
</ul>
<p>The solution should be loaded with
<code class="docutils literal notranslate"><span class="pre">LoadSolutionFile('coordinatesSolution.txt')</span></code>, where ‘coordinatesSolution.txt’ represents the stored solution file,
see</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">exu.SimulationSettings().solutionSettings.coordinatesSolutionFileName</span></code></p></li>
</ul>
<p>You can call the <code class="docutils literal notranslate"><span class="pre">SolutionViewer</span></code> either in the model, or at the command line / IPython to load a previous solution (belonging to the same mbs underlying the solution!):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">exudyn.interactive</span> <span class="kn">import</span> <span class="n">SolutionViewer</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">LoadSolutionFile</span><span class="p">(</span><span class="s1">&#39;coordinatesSolution.txt&#39;</span><span class="p">)</span>
<span class="n">SolutionViewer</span><span class="p">(</span><span class="n">mbs</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Alternatively</strong>, if no solution is provided, <code class="docutils literal notranslate"><span class="pre">SolutionViewer</span></code> tries to reload the solution of the previous simulation that is referred to from <code class="docutils literal notranslate"><span class="pre">mbs.sys[simulationSettings]</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">exudyn.interactive</span> <span class="kn">import</span> <span class="n">SolutionViewer</span>
<span class="n">SolutionViewer</span><span class="p">(</span><span class="n">mbs</span><span class="p">)</span>
</pre></div>
</div>
<p>An example for the <code class="docutils literal notranslate"><span class="pre">SolutionViewer</span></code> is integrated into the <code class="docutils literal notranslate"><span class="pre">Examples/</span></code> directory, see <code class="docutils literal notranslate"><span class="pre">solutionViewerTest.py</span></code>.</p>
<p><strong>Note</strong>: The previous function <code class="docutils literal notranslate"><span class="pre">AnimateSolution</span></code> in <code class="docutils literal notranslate"><span class="pre">exudyn.utilities</span></code> allows to directly visualize the stored solution for according stored time frames without <code class="docutils literal notranslate"><span class="pre">tkinter</span></code> (useful for MacOS).</p>
</section>
<section id="generating-animations">
<h2>Generating animations<a class="headerlink" href="#generating-animations" title="Permalink to this heading"></a></h2>
<p>In many dynamics simulations, it is very helpful to create animations in order to better understand the motion of bodies. Specifically, the animation can be used to visualize the model much slower or faster than the model is computed.</p>
<p>Animations are created based on a series of images (frames, snapshots) taken during simulation. It is important, that the current view is used to record these images – this means that the view should not be changed during the recording of images.
To turn on recording of images during solving, set the following flag to a positive value</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">simulationSettings.solutionSettings.recordImagesInterval</span> <span class="pre">=</span> <span class="pre">0.01</span></code></p></li>
</ul>
<p>which means, that after every 0.01 seconds of simulation time, an image of the current view is taken and stored in the directory and filename (without filename ending) specified by</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SC.visualizationSettings.exportImages.saveImageFileName</span> <span class="pre">=</span> <span class="pre">&quot;myFolder/frame&quot;</span></code></p></li>
</ul>
<p>By default, a consecutive numbering is generated for the image, e.g., ‘frame0000.png, frame0001.png,…’. Note that the standard file format PNG with ending ‘.png’ uses compression libraries included in glfw, while the alternative TGA format produces ‘.tga’ files which contain raw image data and therefore can become very large.</p>
<p>To create animation files, an external tool FFMPEG is used to efficiently convert a series of images into an animation.
=&gt; see theDoc.pdf !</p>
</section>
<section id="examples-test-models-and-test-suite">
<h2>Examples, test models and test suite<a class="headerlink" href="#examples-test-models-and-test-suite" title="Permalink to this heading"></a></h2>
<p>The main collection of examples and models is available under</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">main/pythonDev/Examples</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">main/pythonDev/TestModels</span></code></p></li>
</ul>
<p>You can use these examples to build up your own realistic models of multibody systems.
Very often, these models show the way which already works. Alternative ways may exist, but
sometimes there are limitations in the underlying C++ code, such that they won’t work as you expect.</p>
<p>We would like to note that, even that some examples and test models contain comparison to
papers of the literature or analytical solutions, there are many models which may not contain real
mechanical values and these models may not be converged in space or time
(in order to keep running our test suite in less than a minute).</p>
<p>Finally, note that the <code class="docutils literal notranslate"><span class="pre">main/pythonDev/TestModels</span></code> are often only intended to preserve functionality
in the Python and C++ code (e.g., if global methods are changed), but they should not be misinterpreted as validation of the
implemented methods. The <code class="docutils literal notranslate"><span class="pre">TestModels</span></code> are used in the Exudyn <strong>TestSuite</strong> <code class="docutils literal notranslate"><span class="pre">TestModels/runTestSuite.py</span></code>which is run after a full build of Python versions. Output for very version is written
to <code class="docutils literal notranslate"><span class="pre">main/pythonDev/TestSuiteLogs</span></code> containing the Exudyn version and Python version. At the end of these
files, a summary is included to show if all models completed successfully (which means that a certain error level is achieved, which is rather small and different for the models).
There are also performance tests (e.g., if a certain implementation leads to a significant drop of performance).
However, the output of the performance tests is not stored on github.</p>
<p>We are trying hard to achieve error-free algorithms of physically correct models, but there may always be some errors in the code.</p>
</section>
<section id="removing-convergence-problems-and-solver-failures">
<h2>Removing convergence problems and solver failures<a class="headerlink" href="#removing-convergence-problems-and-solver-failures" title="Permalink to this heading"></a></h2>
<p>Nonlinear formulations (such as most multibody systems, especially nonlinear finite elements) cause problems and there is no general nonlinear solver which may reliably and accurately solve such problems.
Tuning solver parameters is at hand of the user.
In general, the Newton solver tries to reduce the error by the factor given in <code class="docutils literal notranslate"><span class="pre">simulationSettings.staticSolver.newton.relativeTolerance</span></code> (for static solver), which is not possible for very small (or zero) initial residuals. The absolute tolerance is helping out as a lower bound for the error, given in <code class="docutils literal notranslate"><span class="pre">simulationSettings.staticSolver.newton.absoluteTolerance</span></code> (for static solver), which is by default rather low (1e-10) – in order to achieve accurate results for small systems or small motion (in mm or mum regime). Increasing this value helps to solve such problems. Nevertheless, you should usually set tolerances as low as possible because otherwise, your solution may become inaccurate.</p>
<p>The following hints shall be followed (also some solver hints).</p>
<ul class="simple">
<li><p><strong>static solver</strong>: load steps are reduced even if the solution seems to be smooth and less steps are expected; larger number of steps may happen for finer discretization; you may adjust (increase) <code class="docutils literal notranslate"><span class="pre">.newton.relativeTolerance</span></code> / <code class="docutils literal notranslate"><span class="pre">.newton.absoluteTolerance</span></code> in static solver or in time integration to resolve such problems, but check if solution achieves according accuracy</p></li>
<li><p><strong>static solver</strong>: load steps are reduced significantly for highly nonlinear problems; solver repeatedly writes that steps are reduced =&gt; try to use <code class="docutils literal notranslate"><span class="pre">loadStepGeometric</span></code> and use a large <code class="docutils literal notranslate"><span class="pre">loadStepGeometricRange</span></code>: this allows to start with very small loads in which the system is nearly linear (e.g. for thin strings or belts under gravity).</p></li>
<li><p><strong>static solver</strong>: in case that your system is (nearly) kinematic, a static solution can be achieved using <code class="docutils literal notranslate"><span class="pre">stabilizerODE2term</span></code>, which adds mass-proportional stiffness terms during load steps &lt; 1.</p></li>
<li><p>very small loads or even <strong>zero loads</strong> do not converge: <code class="docutils literal notranslate"><span class="pre">SolveDynamic</span></code> or <code class="docutils literal notranslate"><span class="pre">SolveStatic</span></code> <strong>terminated due to errors</strong></p></li>
</ul>
<blockquote>
<div><div class="line-block">
<div class="line">=&gt;  the reason is the nonlinearity of formulations (nonlinear kinematics, nonlinear beam, etc.) and round off errors, which restrict Newton to achieve desired tolerances</div>
<div class="line">=&gt;  adjust (increase) <code class="docutils literal notranslate"><span class="pre">.newton.relativeTolerance</span></code> / <code class="docutils literal notranslate"><span class="pre">.newton.absoluteTolerance</span></code> in static solver or in time integration</div>
<div class="line">=&gt;  in many cases, especially for static problems, the <code class="docutils literal notranslate"><span class="pre">.newton.newtonResidualMode</span> <span class="pre">=</span> <span class="pre">1</span></code> evaluates the increments; the nonlinear problems is assumed to be converged, if increments are within given absolute/relative tolerances; this also works usually better for kinematic solutions</div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>for <strong>discontinuous problems</strong>: try to adjust solver parameters; especially the <code class="docutils literal notranslate"><span class="pre">discontinuous.iterationTolerance</span></code> and <code class="docutils literal notranslate"><span class="pre">discontinuous.maxIterations</span></code>; try to make smaller load or time steps in order to resolve switching points of contact or friction; generalized alpha solvers may cause troubles when reducing step sizes =&gt; use TrapezoidalIndex2 solver</p></li>
<li><p>if you see further problems, please post them (including relevant example) at the Exudyn github page!</p></li>
</ul>
</section>
<section id="performance-and-ways-to-speed-up-computations">
<h2>Performance and ways to speed up computations<a class="headerlink" href="#performance-and-ways-to-speed-up-computations" title="Permalink to this heading"></a></h2>
<p>Multibody dynamics simulation should be accurate and reliable on the one hand side. Most solver settings are such that they lead to comparatively reliable results.
However, in some cases there is a significant possibility for speeding up computations, which are described in the following list. Not all recommendations may apply to your models.</p>
<p>The following examples refer to <code class="docutils literal notranslate"><span class="pre">simulationSettings</span> <span class="pre">=</span> <span class="pre">exu.SimulationSettings()</span></code>.
In general, to see where CPU time is lost, use the option turn on <code class="docutils literal notranslate"><span class="pre">simulationSettings.displayComputationTime</span> <span class="pre">=</span> <span class="pre">True</span></code> to see which parts of the solver need most of the time (deactivated in exudynFast versions!).</p>
<p>To activate the Exudyn C++ versions without range checks, which may be approx. 30 percent faster in some situations, use the following code snippet before first import of <code class="docutils literal notranslate"><span class="pre">exudyn</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">exudynFast</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#this variable is used to signal to load the fast exudyn module</span>
<span class="kn">import</span> <span class="nn">exudyn</span> <span class="k">as</span> <span class="nn">exu</span>
</pre></div>
</div>
<p>The faster versions are available for all release versions, but only for some <code class="docutils literal notranslate"><span class="pre">.dev1</span></code> development versions (Python 3.10), which can be determined by trying <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">exudyn.exudynCPPfast</span></code>.</p>
<p>However, there are many <strong>ways to speed up Exudyn in general</strong>:</p>
<ul class="simple">
<li><p>for models with more than 50 coordinates, switching to sparse solvers might greatly improve speed: <code class="docutils literal notranslate"><span class="pre">simulationSettings.linearSolverType</span> <span class="pre">=</span> <span class="pre">exu.LinearSolverType.EigenSparse</span></code></p></li>
<li><p>try to avoid Python functions or try to speed up Python functions</p></li>
<li><p>instead of user functions in objects or loads (computed in every iteration), some problems would also work if these parameters are only updated in <code class="docutils literal notranslate"><span class="pre">mbs.SetPreStepUserFunction(...)</span></code></p></li>
<li><p>Python user functions can be speed up using the Python numba package, using <code class="docutils literal notranslate"><span class="pre">&#64;jit</span></code> in front of functions (for more options, see <a class="reference external" href="https://numba.pydata.org/numba-doc/dev/user/index.html">https://numba.pydata.org/numba-doc/dev/user/index.html</a>); Example given in <code class="docutils literal notranslate"><span class="pre">Examples/springDamperUserFunctionNumbaJIT.py</span></code> showing speedups of factor 4; more complicated Python functions may see speedups of 10 - 50</p></li>
<li><p>for <strong>discontinuous problems</strong>, try to adjust solver parameters; especially the discontinuous.iterationTolerance which may be too tight and cause many iterations; iterations may be limited by discontinuous.maxIterations, which at larger values solely multiplies the computation time with a factor if all iterations are performed</p></li>
<li><p>For multiple computations / multiple runs of Exudyn (parameter variation, optimization, compute sensitivities), you can use the processing sub module of Exudyn to parallelize computations and achieve speedups proporional to the number of cores/threads of your computer; specifically using the <code class="docutils literal notranslate"><span class="pre">multiThreading</span></code> option or even using a cluster (using <code class="docutils literal notranslate"><span class="pre">dispy</span></code>, see <code class="docutils literal notranslate"><span class="pre">ParameterVariation(...)</span></code> function)</p></li>
<li><p>In case of multiprocessing and cluster computing, you may see a very high CPU usage of “Antimalware Service Executable”, which is the Microsoft Defender Antivirus; you can turn off such problems by excluding <code class="docutils literal notranslate"><span class="pre">python.exe</span></code> from the defender (on your own risk!) in your settings:</p></li>
</ul>
<blockquote>
<div><p>Settings =&gt; Update &amp; Security =&gt; Windows Security =&gt; Virus &amp; threat protection settings =&gt; Manage settings =&gt; Exclusions =&gt; Add or remove exclusions</p>
</div></blockquote>
<p><strong>Possible speed ups for dynamic simulations</strong>:</p>
<ul class="simple">
<li><p>for implicit integration, turn on <strong>modified Newton</strong>, which updates jacobians only if needed: <code class="docutils literal notranslate"><span class="pre">simulationSettings.timeIntegration.newton.useModifiedNewton</span> <span class="pre">=</span> <span class="pre">True</span></code></p></li>
<li><p>use <strong>multi-threading</strong>: <code class="docutils literal notranslate"><span class="pre">simulationSettings.parallel.numberOfThreads</span> <span class="pre">=</span> <span class="pre">...</span></code>, depending on the number of cores (larger values usually do not help); improves greatly for contact problems, but also for some objects computed in parallel; will improve significantly in future</p></li>
<li><p>decrease number of steps (<code class="docutils literal notranslate"><span class="pre">simulationSettings.timeIntegration.numberOfSteps</span> <span class="pre">=</span> <span class="pre">int(tEnd/h)</span></code>) by increasing the step size h if not needed for accuracy reasons; not that in general, the solver will reduce steps in case of divergence, but not for accuracy reasons, which may still lead to divergence if step sizes are too large</p></li>
<li><p>switch off measuring computation time, if not needed: <code class="docutils literal notranslate"><span class="pre">simulationSettings.displayComputationTime</span> <span class="pre">=</span> <span class="pre">False</span></code></p></li>
<li><p>try to switch to <strong>explicit solvers</strong>, if problem has no constraints and if problem is not stiff</p></li>
<li><p>try to have <strong>constant mass matrices</strong> (see according objects, which have constant mass matrices; e.g. rigid bodies using RotationVector Lie group node have constant mass matrix)</p></li>
<li><p>for explicit integration, set <code class="docutils literal notranslate"><span class="pre">computeEndOfStepAccelerations</span> <span class="pre">=</span> <span class="pre">False</span></code>, if you do not need accurate evaluation of accelerations at end of time step (will then be taken from beginning)</p></li>
<li><p>for explicit integration, set <code class="docutils literal notranslate"><span class="pre">explicitIntegration.computeMassMatrixInversePerBody=True</span></code>, which avoids factorization and back substitution, which may speed up computations with many bodies / particles</p></li>
<li><p>if you are sure that your mass matrix is constant, set <code class="docutils literal notranslate"><span class="pre">simulationSettings.timeIntegration.reuseConstantMassMatrix</span> <span class="pre">=</span> <span class="pre">True</span></code>; check results!</p></li>
<li><p>check that <code class="docutils literal notranslate"><span class="pre">simulationSettings.timeIntegration.simulateInRealtime</span> <span class="pre">=</span> <span class="pre">False</span></code>; if set True, it breaks down simulation to real time</p></li>
<li><p>do not record images, if not needed: <code class="docutils literal notranslate"><span class="pre">simulationSettings.solutionSettings.recordImagesInterval</span> <span class="pre">=</span> <span class="pre">-1</span></code></p></li>
<li><p>in case of bad convergence, decreasing the step size might also help; check also other flags for adaptive step size and for Newton</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">simulationSettings.timeIntegration.verboseMode</span> <span class="pre">=</span> <span class="pre">1</span></code>; larger values create lots of output which drastically slows down</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">simulationSettings.timeIntegration.verboseModeFile</span> <span class="pre">=</span> <span class="pre">0</span></code>, otherwise output written to file</p></li>
<li><p>adjust <code class="docutils literal notranslate"><span class="pre">simulationSettings.solutionSettings.sensorsWritePeriod</span></code> to avoid time spent on writing sensor files</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">simulationSettings.timeIntegration.writeSolutionToFile</span> <span class="pre">=</span> <span class="pre">False</span></code>, otherwise much output may be written to file;</p></li>
<li><p>if solution file is needed, adjust <code class="docutils literal notranslate"><span class="pre">simulationSettings.solutionSettings.solutionWritePeriod</span></code> to larger values and also adjust <code class="docutils literal notranslate"><span class="pre">simulationSettings.solutionSettings.outputPrecision</span></code>, e.g., to 6, in order to avoid larger files; also adjust <code class="docutils literal notranslate"><span class="pre">simulationSettings.solutionSettings.exportVelocities</span> <span class="pre">=</span> <span class="pre">False</span></code> and <code class="docutils literal notranslate"><span class="pre">simulationSettings.solutionSettings.exportAccelerations</span> <span class="pre">=</span> <span class="pre">False</span></code> to avoid large output files</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="MappingBetweenLocalAndGlobalCoordinateIndices.html" class="btn btn-neutral float-left" title="Mapping between local and global coordinate indices" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="AdvancedTopics.html" class="btn btn-neutral float-right" title="Advanced topics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>